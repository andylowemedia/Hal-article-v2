<?php

use Behat\Behat\Context\Context;
use Elasticsearch\ClientBuilder;
use Elasticsearch\Client as ElasticsearchClient;
use PHPUnit\Framework\Assert;
use GuzzleHttp\Psr7\Response;
use GuzzleHttp\Client;
use Behat\Behat\Hook\Scope\BeforeScenarioScope;
use Behat\Behat\Hook\Scope\AfterScenarioScope;


/**
 * Defines application features from the specific context.
 */
class SearchContext implements Context
{
    /**
     * @var Response
     */
    private Response $response;

    private array $searchResponses = [
        '/search?index=articles&type=article&filter[categories]=currentAffairs&size=5' => <<<JSON
{"total":31,"count":5,"articles":[{"id":1429588,"slug":"explainer--super-tuesday-contests-offer-big-rewards--challenges-in-u-s--democratic-presidential-race","title":"Explainer: Super Tuesday contests offer big rewards, challenges in U.S. Democratic presidential race","subtitle":"","summary":"WASHINGTON (Reuters) - Fourteen states and one U.S. territory host Super Tuesday primaries next week, a flurry that could bring more clarity about whi","author":"Ginger Gibson","url":"https://uk.reuters.com/article/uk-usa-election-super-tuesday-explainer/explainer-super-tuesday-contests-offer-big-rewards-challenges-in-u-s-democratic-presidential-race-idUKKCN20M1K7","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"https://s4.reutersmedia.net/resources/r/?m=02\u0026d=20200228\u0026t=2\u0026i=1496481076\u0026r=LYNXNPEG1R0WY\u0026w=960","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429590,"slug":"coronavirus-tsar-mike-pence-jets-off-to-florida-for-republican-fundraiser-amid-health-crisis","title":"Coronavirus tsar Mike Pence jets off to Florida for Republican fundraiser amid health crisis","subtitle":"The event is charging $5,000 for people to take pictures with the vice president ","summary":"Coronavirus tsar Mike Pence is jetting off to Florida for a Republican fundraiser on Friday amid the health crisis that\u0027s causing fear among the count","author":"Danielle Zoellner","url":"https://www.independent.co.uk/news/world/americas/coronavirus-mike-pence-trump-cdc-stock-market-florida-republican-fundraiser-a9365816.html","publishDate":"2020-02-29 20:04:13","source":"The Independent","image":"https://static.independent.co.uk/s3fs-public/thumbnails/image/2020/02/24/13/pri141730823.jpg?width=1000\u0026height=614\u0026fit=bounds\u0026format=pjpg\u0026auto=webp\u0026quality=70\u0026crop=16:9,offset-y0.5","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429591,"slug":"the-guardian-view-on-the-assault-on-idlib--the-stakes-are-rising","title":"The Guardian view on the assault on Idlib: the stakes are rising","subtitle":"","summary":"W\\nhat it takes to puncture indifference, it emerges, is not the suffering of ordinary men, women and children, but the prospect that they might escape","author":"Unknown","url":"https://www.theguardian.com/commentisfree/2020/feb/28/the-guardian-view-on-the-assault-on-idlib-the-stakes-are-rising","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/media/9067f37cb045fe4e6c1dd94555f3d3ef03a59037/0_292_3500_2100/master/3500.jpg?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=c17a4782c207fddf7410ba4db73290c6","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429593,"slug":"germany-enacts-new-health-security-measures-against-coronavirus-infections","title":"Germany enacts new health security measures against coronavirus infections","subtitle":"","summary":"FRANKFURT (Reuters) - A German government crisis committee on Friday widened cross-border travel guidelines and cancelled major international events, ","author":"Unknown","url":"https://uk.reuters.com/article/uk-china-health-germany/germany-enacts-new-health-security-measures-against-coronavirus-infections-idUKKCN20M35C?il=0","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429594,"slug":"lebanon-says-schools-to-be-closed-from-feb--29-march-8-amid-coronavirus---education-ministry-statement","title":"Lebanon says schools to be closed from Feb. 29-March 8 amid coronavirus - education ministry statement","subtitle":"","summary":"BEIRUT (Reuters) - Lebanon announced on Friday it was closing the country\u2019s schools effective Feb. 29 until March 8 as a precautionary measure again","author":"Unknown","url":"https://uk.reuters.com/article/uk-china-health-lebanon-education/lebanon-says-schools-to-be-closed-from-feb-29-march-8-amid-coronavirus-education-ministry-statement-idUKKCN20M350?il=0","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]}]}
JSON,
        '/search?index=articles&type=article&filter[categories]=entertainment&size=5' => <<<JSON
{"total":2,"count":2,"articles":[{"id":1429597,"slug":"-i-bet-bon-scott-is-pissing-himself---the-ac-dc-covers-gig-shutting-down-a-major-perth-highway","title":"\u0027I bet Bon Scott is pissing himself\u0027: the AC/DC covers gig shutting down a major Perth highway","subtitle":"","summary":"I\\nt may be a celebration of a uniquely Western Australian cult figure, but Highway To Hell \u2013 the Perth festival\u2019s closing gambit for 2020, which w","author":"Bob Gordon","url":"https://www.theguardian.com/music/2020/feb/29/i-bet-bon-scott-is-pissing-himself-the-acdc-covers-gig-shutting-down-a-major-perth-highway","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/media/ec1ec1128726d2d34bb843a847b8fc1dfd1119b6/0_16_3504_2423/master/3504.jpg?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=c932e103c052e201b3e29f06f8d075f5","displayCategories":[{"code":"entertainment-music","name":"Music"}],"keywords":[],"posted":[]},{"id":1429663,"slug":"novelist-marian-keyes-set-to--marry-herself--at-primadonna-festival","title":"Novelist Marian Keyes set to \u0027marry herself\u0027 at Primadonna festival","subtitle":"","summary":"Award-winning novelist Marian Keyes will be first in line to \u201cmarry herself\u201d at a literary festival promoting work by women.The Primadonna festiva","author":"Caroline Davies","url":"https://www.theguardian.com/books/2020/feb/28/novelist-marian-keyes-set-to-marry-herself-at-primadonna-festival","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/media/734b01b10c4d5ef39c61f3f4ab87a68449fee435/5_483_6656_3997/master/6656.jpg?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=3821dfb24b5c12af9c2a95f40613ae5c","displayCategories":[{"code":"entertainment-books","name":"Books"}],"keywords":[],"posted":[]}]}
JSON,
        '/search?index=articles&type=article&search=brexit&size=5' => <<<JSON
{"total":4,"count":4,"articles":[{"id":1429643,"slug":"can-boris-johnson-ease-the-panic-over-coronavirus-","title":"Can Boris Johnson Ease The Panic Over Coronavirus?","subtitle":"The PM could be facing far worse than being labelled a part-timer.","summary":"You\u2019re reading The Waugh Zone, our daily politics briefing. Sign up now to get it by email in the evening.Last week we were questioning why Boris Jo","author":"Arj Singh","url":"https://www.huffingtonpost.co.uk/entry/can-boris-johnson-ease-the-panic-over-coronavirus_uk_5e595820c5b6450a30be18e7?utm_hp_ref=uk-homepage","publishDate":"2020-02-29 20:04:13","source":"Huffington Post","image":"","displayCategories":[],"keywords":[],"posted":[]},{"id":1429624,"slug":"boris-johnson-government--may-be-breaking-own-climate-change-laws--with---28-8bn-roads-programme","title":"Boris Johnson government \u0027may be breaking own climate change laws\u0027 with \u00a328.8bn roads programme","subtitle":"Transport Action Network is now seeking legal advice \u2018on whether the government is also acting outside the law in pursuing its road building programme\u2019","summary":"Boris Johnson\u2019s government could be challenged in the courts over breaching its own climate change laws with a \u00a329bn road expansion programme.It co","author":"Ashley Cowburn","url":"https://www.independent.co.uk/news/uk/politics/boris-johnson-climate-change-laws-break-roads-heathrow-un-paris-a9364716.html","publishDate":"2020-02-29 20:04:13","source":"The Independent","image":"https://static.independent.co.uk/s3fs-public/thumbnails/image/2020/02/28/17/Greta.jpg?width=1000\u0026height=614\u0026fit=bounds\u0026format=pjpg\u0026auto=webp\u0026quality=70\u0026crop=16:9,offset-y0.5","displayCategories":[{"code":"currentAffairs-UK","name":"UK"}],"keywords":[],"posted":[]},{"id":1429665,"slug":"eu-settlement-scheme--vulnerable--struggling-to-apply-","title":"EU settlement scheme: Vulnerable \u0027struggling to apply\u0027","subtitle":"","summary":"A group representing EU citizens, the3million, claimed some people were \u0022struggling to apply\u0022 or still do not know about the scheme.It comes after the","author":"BBC News","url":"https://www.bbc.com/news/uk-politics-51675813","publishDate":"2020-02-29 20:04:13","source":"BBC News","image":"https://ichef.bbci.co.uk/news/768/cpsprodpb/1493F/production/_111078248_gettyimages-1132734683.jpg","displayCategories":[{"code":"currentAffairs-UK","name":"UK"}],"keywords":[],"posted":[]},{"id":1429657,"slug":"coronavirus--ftse-100-loses---200bn-in-worst-week-for-global-shares-since-2008","title":"Coronavirus: FTSE 100 loses \u00a3200bn in worst week for global shares since 2008","subtitle":"Investors lick their wounds following a week when stock markets woke up to the potential hazards from the coronavirus crisis.","summary":"Fears over the coronavirus crisis have wiped more than \u00a3200bn in value from the FTSE 100 in the worst week for global stock markets since the 2008 fi","author":"Unknown","url":"https://news.sky.com/story/coronavirus-ftse-100-loses-200bn-in-worst-week-for-global-shares-since-2008-11945636","publishDate":"2020-02-29 20:04:13","source":"Sky News","image":"https://e3.365dm.com/20/02/768x432/2372002280998467907_4933542.jpg?20200228125940","displayCategories":[{"code":"business","name":"Business"}],"keywords":[],"posted":[]}]}
JSON,
        '/search?index=articles&type=article&exists[]=image&size=5' => <<<JSON
{"total":87,"count":5,"articles":[{"id":1429588,"slug":"explainer--super-tuesday-contests-offer-big-rewards--challenges-in-u-s--democratic-presidential-race","title":"Explainer: Super Tuesday contests offer big rewards, challenges in U.S. Democratic presidential race","subtitle":"","summary":"WASHINGTON (Reuters) - Fourteen states and one U.S. territory host Super Tuesday primaries next week, a flurry that could bring more clarity about whi","author":"Ginger Gibson","url":"https://uk.reuters.com/article/uk-usa-election-super-tuesday-explainer/explainer-super-tuesday-contests-offer-big-rewards-challenges-in-u-s-democratic-presidential-race-idUKKCN20M1K7","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"https://s4.reutersmedia.net/resources/r/?m=02\u0026d=20200228\u0026t=2\u0026i=1496481076\u0026r=LYNXNPEG1R0WY\u0026w=960","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429589,"slug":"donald-trump---s-war-on-coronavirus-is-just-his-latest-war-on-truth","title":"Donald Trump\u2019s war on coronavirus is just his latest war on truth","subtitle":"","summary":"T\\nhe coronavirus crisis is a war against a disease, but it\u2019s also the most serious battle yet in the war on truth. That much was clear from the star","author":"Unknown","url":"https://www.theguardian.com/commentisfree/2020/feb/28/coronavirus-donald-trump-truth-president","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/uploads/2017/10/06/Jonathan-Freedland,-L.png?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=90f61dcd11d7b649b02bd894f077a689","displayCategories":[{"code":"politics","name":"Politics"}],"keywords":[],"posted":[]},{"id":1429590,"slug":"coronavirus-tsar-mike-pence-jets-off-to-florida-for-republican-fundraiser-amid-health-crisis","title":"Coronavirus tsar Mike Pence jets off to Florida for Republican fundraiser amid health crisis","subtitle":"The event is charging $5,000 for people to take pictures with the vice president ","summary":"Coronavirus tsar Mike Pence is jetting off to Florida for a Republican fundraiser on Friday amid the health crisis that\u0027s causing fear among the count","author":"Danielle Zoellner","url":"https://www.independent.co.uk/news/world/americas/coronavirus-mike-pence-trump-cdc-stock-market-florida-republican-fundraiser-a9365816.html","publishDate":"2020-02-29 20:04:13","source":"The Independent","image":"https://static.independent.co.uk/s3fs-public/thumbnails/image/2020/02/24/13/pri141730823.jpg?width=1000\u0026height=614\u0026fit=bounds\u0026format=pjpg\u0026auto=webp\u0026quality=70\u0026crop=16:9,offset-y0.5","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429591,"slug":"the-guardian-view-on-the-assault-on-idlib--the-stakes-are-rising","title":"The Guardian view on the assault on Idlib: the stakes are rising","subtitle":"","summary":"W\\nhat it takes to puncture indifference, it emerges, is not the suffering of ordinary men, women and children, but the prospect that they might escape","author":"Unknown","url":"https://www.theguardian.com/commentisfree/2020/feb/28/the-guardian-view-on-the-assault-on-idlib-the-stakes-are-rising","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/media/9067f37cb045fe4e6c1dd94555f3d3ef03a59037/0_292_3500_2100/master/3500.jpg?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=c17a4782c207fddf7410ba4db73290c6","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429592,"slug":"ted-cruz-tried-to-mock-aoc-s-scientific-knowledge-----it-didn-t-end-well","title":"Ted Cruz tried to mock AOC\u0027s scientific knowledge \u2013 it didn\u0027t end well","subtitle":"","summary":"If you were in search of a scientifically minded, steadying presence to guide the country through the potential fallout of the coronavirus, you could ","author":"Luke O\u0027Neil","url":"https://www.theguardian.com/us-news/2020/feb/28/alexandria-ocasio-cortez-ted-cruz-coronavirus","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/media/3f498fda39ba0ca42dacc900f71be8882355732b/0_101_3000_1800/master/3000.jpg?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=7ed3fd69d455556ea265fb2b4801c601","displayCategories":[{"code":"politics","name":"Politics"}],"keywords":[],"posted":[]}]}
JSON,
        '/search?index=articles&type=article&not-exists[]=image&size=5' => <<<JSON
{"total":8,"count":5,"articles":[{"id":1429593,"slug":"germany-enacts-new-health-security-measures-against-coronavirus-infections","title":"Germany enacts new health security measures against coronavirus infections","subtitle":"","summary":"FRANKFURT (Reuters) - A German government crisis committee on Friday widened cross-border travel guidelines and cancelled major international events, ","author":"Unknown","url":"https://uk.reuters.com/article/uk-china-health-germany/germany-enacts-new-health-security-measures-against-coronavirus-infections-idUKKCN20M35C?il=0","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429594,"slug":"lebanon-says-schools-to-be-closed-from-feb--29-march-8-amid-coronavirus---education-ministry-statement","title":"Lebanon says schools to be closed from Feb. 29-March 8 amid coronavirus - education ministry statement","subtitle":"","summary":"BEIRUT (Reuters) - Lebanon announced on Friday it was closing the country\u2019s schools effective Feb. 29 until March 8 as a precautionary measure again","author":"Unknown","url":"https://uk.reuters.com/article/uk-china-health-lebanon-education/lebanon-says-schools-to-be-closed-from-feb-29-march-8-amid-coronavirus-education-ministry-statement-idUKKCN20M350?il=0","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429608,"slug":"google-employee-who-was-at-zurich-office-tests-positive-for-coronavirus","title":"Google employee who was at Zurich office tests positive for coronavirus","subtitle":"","summary":"(Reuters) - An employee of Alphabet Inc\u2019s (GOOGL.O) Google, who had been in the Zurich office, has tested positive for coronavirus, the company said","author":"Unknown","url":"https://uk.reuters.com/article/uk-china-health-google/google-employee-who-was-at-zurich-office-tests-positive-for-coronavirus-idUKKCN20M2ZO?il=0","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"","displayCategories":[{"code":"business","name":"Business"}],"keywords":[],"posted":[]},{"id":1429609,"slug":"berlin-itb-trade-fair-cancelled-due-to-coronavirus","title":"Berlin ITB trade fair cancelled due to coronavirus","subtitle":"","summary":"FRANKFURT (Reuters) - Germany\u2019s ITB Tourism Fair has been cancelled due to the spread of the coronavirus, organisers Messe Berlin GmbH said on Frida","author":"Unknown","url":"https://uk.reuters.com/article/uk-china-health-itb-cancellation/berlin-itb-trade-fair-cancelled-due-to-coronavirus-idUKKCN20M2ZC?il=0","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429612,"slug":"u-s--looking-to-help-turkey-in-syria-via-info-sharing--equipment---u-s--official","title":"U.S. looking to help Turkey in Syria via info-sharing, equipment - U.S. official","subtitle":"","summary":"WASHINGTON (Reuters) - The United States is looking urgently to support Ankara with information-sharing and equipment after 33 Turkish soldiers were k","author":"Unknown","url":"https://uk.reuters.com/article/uk-syria-security-usa-turkey/u-s-looking-to-help-turkey-in-syria-via-info-sharing-equipment-u-s-official-idUKKCN20M33C?il=0","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]}]}
JSON,
        '/search?index=articles&type=article&not-filter[categories]=entertainment&size=5' => <<<JSON
{"total":93,"count":5,"articles":[{"id":1429588,"slug":"explainer--super-tuesday-contests-offer-big-rewards--challenges-in-u-s--democratic-presidential-race","title":"Explainer: Super Tuesday contests offer big rewards, challenges in U.S. Democratic presidential race","subtitle":"","summary":"WASHINGTON (Reuters) - Fourteen states and one U.S. territory host Super Tuesday primaries next week, a flurry that could bring more clarity about whi","author":"Ginger Gibson","url":"https://uk.reuters.com/article/uk-usa-election-super-tuesday-explainer/explainer-super-tuesday-contests-offer-big-rewards-challenges-in-u-s-democratic-presidential-race-idUKKCN20M1K7","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"https://s4.reutersmedia.net/resources/r/?m=02\u0026d=20200228\u0026t=2\u0026i=1496481076\u0026r=LYNXNPEG1R0WY\u0026w=960","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429589,"slug":"donald-trump---s-war-on-coronavirus-is-just-his-latest-war-on-truth","title":"Donald Trump\u2019s war on coronavirus is just his latest war on truth","subtitle":"","summary":"T\\nhe coronavirus crisis is a war against a disease, but it\u2019s also the most serious battle yet in the war on truth. That much was clear from the star","author":"Unknown","url":"https://www.theguardian.com/commentisfree/2020/feb/28/coronavirus-donald-trump-truth-president","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/uploads/2017/10/06/Jonathan-Freedland,-L.png?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=90f61dcd11d7b649b02bd894f077a689","displayCategories":[{"code":"politics","name":"Politics"}],"keywords":[],"posted":[]},{"id":1429590,"slug":"coronavirus-tsar-mike-pence-jets-off-to-florida-for-republican-fundraiser-amid-health-crisis","title":"Coronavirus tsar Mike Pence jets off to Florida for Republican fundraiser amid health crisis","subtitle":"The event is charging $5,000 for people to take pictures with the vice president ","summary":"Coronavirus tsar Mike Pence is jetting off to Florida for a Republican fundraiser on Friday amid the health crisis that\u0027s causing fear among the count","author":"Danielle Zoellner","url":"https://www.independent.co.uk/news/world/americas/coronavirus-mike-pence-trump-cdc-stock-market-florida-republican-fundraiser-a9365816.html","publishDate":"2020-02-29 20:04:13","source":"The Independent","image":"https://static.independent.co.uk/s3fs-public/thumbnails/image/2020/02/24/13/pri141730823.jpg?width=1000\u0026height=614\u0026fit=bounds\u0026format=pjpg\u0026auto=webp\u0026quality=70\u0026crop=16:9,offset-y0.5","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429591,"slug":"the-guardian-view-on-the-assault-on-idlib--the-stakes-are-rising","title":"The Guardian view on the assault on Idlib: the stakes are rising","subtitle":"","summary":"W\\nhat it takes to puncture indifference, it emerges, is not the suffering of ordinary men, women and children, but the prospect that they might escape","author":"Unknown","url":"https://www.theguardian.com/commentisfree/2020/feb/28/the-guardian-view-on-the-assault-on-idlib-the-stakes-are-rising","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/media/9067f37cb045fe4e6c1dd94555f3d3ef03a59037/0_292_3500_2100/master/3500.jpg?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=c17a4782c207fddf7410ba4db73290c6","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429592,"slug":"ted-cruz-tried-to-mock-aoc-s-scientific-knowledge-----it-didn-t-end-well","title":"Ted Cruz tried to mock AOC\u0027s scientific knowledge \u2013 it didn\u0027t end well","subtitle":"","summary":"If you were in search of a scientifically minded, steadying presence to guide the country through the potential fallout of the coronavirus, you could ","author":"Luke O\u0027Neil","url":"https://www.theguardian.com/us-news/2020/feb/28/alexandria-ocasio-cortez-ted-cruz-coronavirus","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/media/3f498fda39ba0ca42dacc900f71be8882355732b/0_101_3000_1800/master/3000.jpg?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=7ed3fd69d455556ea265fb2b4801c601","displayCategories":[{"code":"politics","name":"Politics"}],"keywords":[],"posted":[]}]}
JSON,
        '/search?index=articles&type=article&not-exists[]=image&size=5&sort=publishDate:desc' => <<<JSON
{"total":8,"count":5,"articles":[{"id":1429593,"slug":"germany-enacts-new-health-security-measures-against-coronavirus-infections","title":"Germany enacts new health security measures against coronavirus infections","subtitle":"","summary":"FRANKFURT (Reuters) - A German government crisis committee on Friday widened cross-border travel guidelines and cancelled major international events, ","author":"Unknown","url":"https://uk.reuters.com/article/uk-china-health-germany/germany-enacts-new-health-security-measures-against-coronavirus-infections-idUKKCN20M35C?il=0","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429594,"slug":"lebanon-says-schools-to-be-closed-from-feb--29-march-8-amid-coronavirus---education-ministry-statement","title":"Lebanon says schools to be closed from Feb. 29-March 8 amid coronavirus - education ministry statement","subtitle":"","summary":"BEIRUT (Reuters) - Lebanon announced on Friday it was closing the country\u2019s schools effective Feb. 29 until March 8 as a precautionary measure again","author":"Unknown","url":"https://uk.reuters.com/article/uk-china-health-lebanon-education/lebanon-says-schools-to-be-closed-from-feb-29-march-8-amid-coronavirus-education-ministry-statement-idUKKCN20M350?il=0","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429608,"slug":"google-employee-who-was-at-zurich-office-tests-positive-for-coronavirus","title":"Google employee who was at Zurich office tests positive for coronavirus","subtitle":"","summary":"(Reuters) - An employee of Alphabet Inc\u2019s (GOOGL.O) Google, who had been in the Zurich office, has tested positive for coronavirus, the company said","author":"Unknown","url":"https://uk.reuters.com/article/uk-china-health-google/google-employee-who-was-at-zurich-office-tests-positive-for-coronavirus-idUKKCN20M2ZO?il=0","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"","displayCategories":[{"code":"business","name":"Business"}],"keywords":[],"posted":[]},{"id":1429609,"slug":"berlin-itb-trade-fair-cancelled-due-to-coronavirus","title":"Berlin ITB trade fair cancelled due to coronavirus","subtitle":"","summary":"FRANKFURT (Reuters) - Germany\u2019s ITB Tourism Fair has been cancelled due to the spread of the coronavirus, organisers Messe Berlin GmbH said on Frida","author":"Unknown","url":"https://uk.reuters.com/article/uk-china-health-itb-cancellation/berlin-itb-trade-fair-cancelled-due-to-coronavirus-idUKKCN20M2ZC?il=0","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429612,"slug":"u-s--looking-to-help-turkey-in-syria-via-info-sharing--equipment---u-s--official","title":"U.S. looking to help Turkey in Syria via info-sharing, equipment - U.S. official","subtitle":"","summary":"WASHINGTON (Reuters) - The United States is looking urgently to support Ankara with information-sharing and equipment after 33 Turkish soldiers were k","author":"Unknown","url":"https://uk.reuters.com/article/uk-syria-security-usa-turkey/u-s-looking-to-help-turkey-in-syria-via-info-sharing-equipment-u-s-official-idUKKCN20M33C?il=0","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]}]}
JSON,
        '/search?index=articles&type=article&date-fr=2020-01-01&date-to=2020-02-29&sort=publishDate:desc&size=5' => <<<JSON
{"total":95,"count":5,"articles":[{"id":1429588,"slug":"explainer--super-tuesday-contests-offer-big-rewards--challenges-in-u-s--democratic-presidential-race","title":"Explainer: Super Tuesday contests offer big rewards, challenges in U.S. Democratic presidential race","subtitle":"","summary":"WASHINGTON (Reuters) - Fourteen states and one U.S. territory host Super Tuesday primaries next week, a flurry that could bring more clarity about whi","author":"Ginger Gibson","url":"https://uk.reuters.com/article/uk-usa-election-super-tuesday-explainer/explainer-super-tuesday-contests-offer-big-rewards-challenges-in-u-s-democratic-presidential-race-idUKKCN20M1K7","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"https://s4.reutersmedia.net/resources/r/?m=02\u0026d=20200228\u0026t=2\u0026i=1496481076\u0026r=LYNXNPEG1R0WY\u0026w=960","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429589,"slug":"donald-trump---s-war-on-coronavirus-is-just-his-latest-war-on-truth","title":"Donald Trump\u2019s war on coronavirus is just his latest war on truth","subtitle":"","summary":"T\\nhe coronavirus crisis is a war against a disease, but it\u2019s also the most serious battle yet in the war on truth. That much was clear from the star","author":"Unknown","url":"https://www.theguardian.com/commentisfree/2020/feb/28/coronavirus-donald-trump-truth-president","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/uploads/2017/10/06/Jonathan-Freedland,-L.png?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=90f61dcd11d7b649b02bd894f077a689","displayCategories":[{"code":"politics","name":"Politics"}],"keywords":[],"posted":[]},{"id":1429590,"slug":"coronavirus-tsar-mike-pence-jets-off-to-florida-for-republican-fundraiser-amid-health-crisis","title":"Coronavirus tsar Mike Pence jets off to Florida for Republican fundraiser amid health crisis","subtitle":"The event is charging $5,000 for people to take pictures with the vice president ","summary":"Coronavirus tsar Mike Pence is jetting off to Florida for a Republican fundraiser on Friday amid the health crisis that\u0027s causing fear among the count","author":"Danielle Zoellner","url":"https://www.independent.co.uk/news/world/americas/coronavirus-mike-pence-trump-cdc-stock-market-florida-republican-fundraiser-a9365816.html","publishDate":"2020-02-29 20:04:13","source":"The Independent","image":"https://static.independent.co.uk/s3fs-public/thumbnails/image/2020/02/24/13/pri141730823.jpg?width=1000\u0026height=614\u0026fit=bounds\u0026format=pjpg\u0026auto=webp\u0026quality=70\u0026crop=16:9,offset-y0.5","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429591,"slug":"the-guardian-view-on-the-assault-on-idlib--the-stakes-are-rising","title":"The Guardian view on the assault on Idlib: the stakes are rising","subtitle":"","summary":"W\\nhat it takes to puncture indifference, it emerges, is not the suffering of ordinary men, women and children, but the prospect that they might escape","author":"Unknown","url":"https://www.theguardian.com/commentisfree/2020/feb/28/the-guardian-view-on-the-assault-on-idlib-the-stakes-are-rising","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/media/9067f37cb045fe4e6c1dd94555f3d3ef03a59037/0_292_3500_2100/master/3500.jpg?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=c17a4782c207fddf7410ba4db73290c6","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429592,"slug":"ted-cruz-tried-to-mock-aoc-s-scientific-knowledge-----it-didn-t-end-well","title":"Ted Cruz tried to mock AOC\u0027s scientific knowledge \u2013 it didn\u0027t end well","subtitle":"","summary":"If you were in search of a scientifically minded, steadying presence to guide the country through the potential fallout of the coronavirus, you could ","author":"Luke O\u0027Neil","url":"https://www.theguardian.com/us-news/2020/feb/28/alexandria-ocasio-cortez-ted-cruz-coronavirus","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/media/3f498fda39ba0ca42dacc900f71be8882355732b/0_101_3000_1800/master/3000.jpg?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=7ed3fd69d455556ea265fb2b4801c601","displayCategories":[{"code":"politics","name":"Politics"}],"keywords":[],"posted":[]}]}
JSON,
        '/search?index=articles&type=article&keywords[]=alesha+dixon&sort=publishDate:desc' => <<<JSON
{"total":1,"count":1,"articles":[{"id":1429683,"slug":"alesha-dixon-reckons--time-is-running-out--for-her-to-have-third-baby-in-candid-motherhood-chat","title":"Alesha Dixon reckons \u0027time is running out\u0027 for her to have third baby in candid motherhood chat","subtitle":"Alesha chatted to Rochelle Humes and Eamonn Holmes about her two kids growing up before revealing she thinks time could be \u0027running out\u0027 for her to add to her brood again","summary":"Britain\u0027s Got Talent judge Alesha Dixon says that \u0022time is running out\u0022 for her to have baby number three.Alesha, 41, is mum to Azura, six, and Anaya,","author":"Will Twigger","url":"https://www.mirror.co.uk/tv/tv-news/alesha-dixon-reckons-time-running-21599563","publishDate":"2020-02-29 20:04:13","source":"Daily Mirror","image":"https://i2-prod.mirror.co.uk/incoming/article21599900.ece/ALTERNATES/s615b/1_RLP_MDG_2094821762JPG.jpg","displayCategories":[],"keywords":["alesha dixon"],"posted":[]}]}
JSON,
        '/search?index=articles&type=article&excludes[title][]=brexit&size=5' => <<<JSON
{"total":95,"count":5,"articles":[{"id":1429588,"slug":"explainer--super-tuesday-contests-offer-big-rewards--challenges-in-u-s--democratic-presidential-race","title":"Explainer: Super Tuesday contests offer big rewards, challenges in U.S. Democratic presidential race","subtitle":"","summary":"WASHINGTON (Reuters) - Fourteen states and one U.S. territory host Super Tuesday primaries next week, a flurry that could bring more clarity about whi","author":"Ginger Gibson","url":"https://uk.reuters.com/article/uk-usa-election-super-tuesday-explainer/explainer-super-tuesday-contests-offer-big-rewards-challenges-in-u-s-democratic-presidential-race-idUKKCN20M1K7","publishDate":"2020-02-29 20:04:13","source":"Reuters","image":"https://s4.reutersmedia.net/resources/r/?m=02\u0026d=20200228\u0026t=2\u0026i=1496481076\u0026r=LYNXNPEG1R0WY\u0026w=960","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429589,"slug":"donald-trump---s-war-on-coronavirus-is-just-his-latest-war-on-truth","title":"Donald Trump\u2019s war on coronavirus is just his latest war on truth","subtitle":"","summary":"T\\nhe coronavirus crisis is a war against a disease, but it\u2019s also the most serious battle yet in the war on truth. That much was clear from the star","author":"Unknown","url":"https://www.theguardian.com/commentisfree/2020/feb/28/coronavirus-donald-trump-truth-president","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/uploads/2017/10/06/Jonathan-Freedland,-L.png?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=90f61dcd11d7b649b02bd894f077a689","displayCategories":[{"code":"politics","name":"Politics"}],"keywords":[],"posted":[]},{"id":1429590,"slug":"coronavirus-tsar-mike-pence-jets-off-to-florida-for-republican-fundraiser-amid-health-crisis","title":"Coronavirus tsar Mike Pence jets off to Florida for Republican fundraiser amid health crisis","subtitle":"The event is charging $5,000 for people to take pictures with the vice president ","summary":"Coronavirus tsar Mike Pence is jetting off to Florida for a Republican fundraiser on Friday amid the health crisis that\u0027s causing fear among the count","author":"Danielle Zoellner","url":"https://www.independent.co.uk/news/world/americas/coronavirus-mike-pence-trump-cdc-stock-market-florida-republican-fundraiser-a9365816.html","publishDate":"2020-02-29 20:04:13","source":"The Independent","image":"https://static.independent.co.uk/s3fs-public/thumbnails/image/2020/02/24/13/pri141730823.jpg?width=1000\u0026height=614\u0026fit=bounds\u0026format=pjpg\u0026auto=webp\u0026quality=70\u0026crop=16:9,offset-y0.5","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429591,"slug":"the-guardian-view-on-the-assault-on-idlib--the-stakes-are-rising","title":"The Guardian view on the assault on Idlib: the stakes are rising","subtitle":"","summary":"W\\nhat it takes to puncture indifference, it emerges, is not the suffering of ordinary men, women and children, but the prospect that they might escape","author":"Unknown","url":"https://www.theguardian.com/commentisfree/2020/feb/28/the-guardian-view-on-the-assault-on-idlib-the-stakes-are-rising","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/media/9067f37cb045fe4e6c1dd94555f3d3ef03a59037/0_292_3500_2100/master/3500.jpg?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=c17a4782c207fddf7410ba4db73290c6","displayCategories":[{"code":"currentAffairs-world","name":"World"}],"keywords":[],"posted":[]},{"id":1429592,"slug":"ted-cruz-tried-to-mock-aoc-s-scientific-knowledge-----it-didn-t-end-well","title":"Ted Cruz tried to mock AOC\u0027s scientific knowledge \u2013 it didn\u0027t end well","subtitle":"","summary":"If you were in search of a scientifically minded, steadying presence to guide the country through the potential fallout of the coronavirus, you could ","author":"Luke O\u0027Neil","url":"https://www.theguardian.com/us-news/2020/feb/28/alexandria-ocasio-cortez-ted-cruz-coronavirus","publishDate":"2020-02-29 20:04:13","source":"The Guardian","image":"https://i.guim.co.uk/img/media/3f498fda39ba0ca42dacc900f71be8882355732b/0_101_3000_1800/master/3000.jpg?width=300\u0026quality=85\u0026auto=format\u0026fit=max\u0026s=7ed3fd69d455556ea265fb2b4801c601","displayCategories":[{"code":"politics","name":"Politics"}],"keywords":[],"posted":[]}]}
JSON,

    ];

    /**
     * @Given the microservice search URL is loaded :url
     * @param string $url
     */
    public function theMicroserviceSearchUrlIsLoaded(string $url)
    {
        $client = new Client();
        $this->response = $client->get('hal-article-web/' . $url, ['http_errors' => false]);

    }

    /**
     * @When a :statusCode search response is be received
     * @param int $statusCode
     */
    public function aSearchResponseIsBeReceived(int $statusCode)
    {
        Assert::assertEquals($statusCode, $this->response->getStatusCode());
    }

    /**
     * @Then URL :url search content will be returned in a JSON format
     * @param string $url
     */
    public function urlSearchContentWillBeReturnedInAJsonFormat(string $url)
    {
        $expected = $this->searchResponses[$url];

        $actual = $this->response->getBody()->getContents();

        Assert::assertEquals(json_decode($expected), json_decode($actual));
    }

    /**
     * @Then an empty search response will be returned
     */
    public function anEmptySearchResponseWillBeReturned(): void
    {
        Assert::assertEmpty($this->response->getBody()->getContents());
    }

    /**
     * @BeforeScenario
     * @param BeforeScenarioScope $scope
     */
    public function before(BeforeScenarioScope $scope)
    {
        $host = getenv('DB_ARTICLE_HOST');
        $schema = getenv('DB_ARTICLE_SCHEMA');
        $user = getenv('DB_ARTICLE_USER');
        $password = getenv('DB_ARTICLE_PASSWORD');

        $db = new PDO("mysql:host=$host", $user, $password);

        $db->exec('DROP DATABASE IF EXISTS `hal-articles`;');
        $db->exec('CREATE SCHEMA `hal-articles` DEFAULT CHARACTER SET utf8;');
        $db->exec('USE `hal-articles`;');

        $sql = file_get_contents(getcwd() . '/sql/hal-article.sql');

        $db->exec($sql);

        shell_exec('/var/www/html/bin/console app:create-index');
        shell_exec('/var/www/html/bin/console app:build-articles-index');

        sleep(2);
    }

    /**
     * @AfterScenario
     * @param AfterScenarioScope $scope
     */
    public function after(AfterScenarioScope $scope)
    {
        $host = getenv('DB_ARTICLE_HOST');
        $schema = getenv('DB_ARTICLE_SCHEMA');
        $user = getenv('DB_ARTICLE_USER');
        $password = getenv('DB_ARTICLE_PASSWORD');

        $db = new PDO("mysql:host=$host;dbname=$schema", $user, $password);

        $db->exec('DROP DATABASE IF EXISTS `hal-articles`;');

        shell_exec('/var/www/html/bin/console app:delete-index articles');
    }
}

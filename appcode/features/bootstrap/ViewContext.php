<?php

use Behat\Behat\Context\Context;
use PHPUnit\Framework\Assert;
use GuzzleHttp\Psr7\Response;
use GuzzleHttp\Client;

/**
 * Defines application features from the specific context.
 */
class ViewContext implements Context
{
    /**
     * @var Response
     */
    private Response $response;

    private array $articleResponses = [
        'explainer--super-tuesday-contests-offer-big-rewards--challenges-in-u-s--democratic-presidential-race' => <<<JSON
{"article":{"title":"Explainer: Super Tuesday contests offer big rewards, challenges in U.S. Democratic presidential race","subtitle":"","slug":"explainer--super-tuesday-contests-offer-big-rewards--challenges-in-u-s--democratic-presidential-race","summary":"WASHINGTON (Reuters) - Fourteen states and one U.S. territory host Super Tuesday primaries next week, a flurry that could bring more clarity about whi","content":"\u003Cp\u003EWASHINGTON (Reuters) - Fourteen states and one U.S. territory host Super Tuesday primaries next week, a flurry that could bring more clarity about which Democratic presidential contender voters prefer to challenge Republican President Donald Trump in November.\u003C/p\u003E\u003Cp\u003EMore than a third of delegates will be doled out in Tuesday\u2019s nominating contests, compared with less than 5% awarded from the four states voting in February. A candidate needs 1,991 delegates to win the Democratic nomination at the party\u2019s national convention in July.\u003C/p\u003E\u003Cp\u003EThe votes will test the front-runner status secured by Senator Bernie Sanders after wins in New Hampshire and Nevada and a near-tie in Iowa. Former New York Mayor Michael Bloomberg will be on ballots for the first time, potentially further splintering the field of candidates campaigning as a moderate alternative to Sanders, a self-described democratic socialist.\u003C/p\u003E\u003Cp\u003EHere is what you need to know about this key day in the Democratic presidential nominating battle.\u003C/p\u003E\u003Cp\u003EWhat is Super Tuesday?\u003C/p\u003E\u003Cp\u003EAfter a month of states holding nominating contests one by one, Tuesday marks the first time a group of states hold primary elections on the same day. Historically, the batch of primaries has further winnowed the field.\u003C/p\u003E\u003Cp\u003ECalifornia and Texas are the day\u2019s biggest prizes, with 415 and 228 delegates, respectively. California, the most populous U.S. state, held its primary in June during the 2016 presidential race but opted to return as a Super Tuesday state this cycle to try to increase its influence.\u003C/p\u003E\u003Cp\u003EThe other states with primaries on Tuesday are Alabama, Arkansas, Colorado, Maine, Massachusetts, Minnesota, North Carolina, Oklahoma, Tennessee, Utah, Vermont and Virginia.\u003C/p\u003E\u003Cp\u003EVotes will also be conducted in American Samoa, a U.S. Pacific territory, and among a newly formed group of Americans living abroad.\u003C/p\u003E\u003Cp\u003EWhat is at stake?\u003C/p\u003E\u003Cp\u003EOn Super Tuesday, 1,357 delegates will be awarded, a significant chunk of the 3,979 pledged delegates at stake in the nominating race.\u003C/p\u003E\u003Cp\u003EIn order for candidates to win any delegates in a state, they must finish with at least 15% of the vote, either in the statewide total or an individual congressional district.\u003C/p\u003E\u003Cp\u003ENorth Carolina, with its 110 delegates, could give the winning candidate bragging rights about success in a general election battleground state.\u003C/p\u003E\u003Cp\u003ESanders, Elizabeth Warren and Amy Klobuchar will be tested in the respective states they represent in the Senate - Vermont (16 delegates), Massachusetts (91 delegates) and Minnesota (75 delegates).\u003C/p\u003E\u003Cp\u003EThe other states\u0027 delegate counts are as follows: Virginia (99), Colorado (67), Tennessee (64), Alabama (52), Oklahoma (37), Arkansas (31), Utah (29) and Maine (24). Additionally, 13 delegates will be awarded for \u0022Democrats Abroad\u0022 and six in American Samoa. (tmsnrt.rs/37bDD2f)\u003C/p\u003E\u003Cp\u003EWho is best positioned to win?\u003C/p\u003E\u003Cp\u003ETo be competitive on Super Tuesday, candidates cannot simply invest time and money in one place to try to win votes. Instead, they must have the infrastructure and fundraising to air television ads and have staff in states across the country.\u003C/p\u003E\u003Cp\u003ESanders tops opinion polls in California, where he is hoping to capitalize on his momentum to build a large lead. Former Vice President Joe Biden has seen his position there slide after failing to win any of the first three state votes.\u003C/p\u003E\u003Cp\u003EBiden hopes to gain ground in South Carolina, where he leads polls ahead of its primary on Saturday. But he and former South Bend, Indiana, Mayor Pete Buttigieg have struggled to match Sanders in fundraising, making it harder for them to compete on a broader scale.\u003C/p\u003E\u003Cp\u003EBloomberg, a billionaire businessman, skipped the early states and has spent more than $500 million running ads in Super Tuesday states as he looks to surpass Biden and Buttigieg as the front-runner among moderates.\u003C/p\u003E\u003Cp\u003EBloomberg appears to be taking moderate voters from Biden in Texas, where both men are hoping to best Sanders.\u003C/p\u003E\u003Cp\u003EThe trio of states represented by candidates still in the running will also be closely watched. Sanders is the easy favourite in Vermont, but Warren and Klobuchar face tougher fights in their home states.\u003C/p\u003E\u003Cp\u003EWhen will we know results?\u003C/p\u003E\u003Cp\u003EWith the exception of a single caucus in American Samoa, the rest of the Super Tuesday states are holding primaries, meaning they should be able to avoid the problems that led to reporting delays after caucuses in Iowa and Nevada.\u003C/p\u003E\u003Cp\u003EBut with so many states voting, the full picture of Super Tuesday results could still take days to emerge.\u003C/p\u003E\u003Cp\u003ESeveral states in the Eastern time zone will be the first to close their polls on Tuesday at 7 p.m. EST (0000 GMT). Results should start to trickle in soon afterward, although it will likely take hours for all the votes to be tabulated and winners declared.\u003C/p\u003E\u003Cp\u003ECalifornia\u2019s polls close last at 8 p.m. PST (0400 GMT Wednesday). In 2016, because the race was so close, it took a month for California Democratic officials to count all of the votes and declare Hillary Clinton the winner over Sanders.\u003C/p\u003E\u003Cp\u003EState officials are hoping that even with a tight race and bigger field this year, the Democratic nominating battle is settled more quickly. If the margins are close, the state could take a while to reach a conclusion as it waits to count absentee ballots postmarked by Election Day.\u003C/p\u003E\u003Cp\u003EReporting by Ginger Gibson; Editing by Colleen Jenkins and Peter Cooney\u003C/p\u003E","author":"Ginger Gibson","url":"https://uk.reuters.com/article/uk-usa-election-super-tuesday-explainer/explainer-super-tuesday-contests-offer-big-rewards-challenges-in-u-s-democratic-presidential-race-idUKKCN20M1K7","source":"Reuters","publishDate":"2020-02-29T20:04:13+00:00","date":"2020-02-29T20:04:13+00:00","status":"2","articleTypeId":"1","sourceId":"9","keywords":[""],"image":"https://s4.reutersmedia.net/resources/r/?m=02\u0026d=20200228\u0026t=2\u0026i=1496481076\u0026r=LYNXNPEG1R0WY\u0026w=960","images":["https://s4.reutersmedia.net/resources/r/?m=02\u0026d=20200228\u0026t=2\u0026i=1496481076\u0026r=LYNXNPEG1R0WY\u0026w=960","https://s4.reutersmedia.net/resources/r/?m=02\u0026d=20200228\u0026t=2\u0026i=1496481076\u0026r=LYNXNPEG1R0WY\u0026w=20"],"featured":"1","categories":["currentAffairs","currentAffairs-world"],"displayCategories":[{"code":"currentAffairs-world","name":"World"}],"id":"1429588"}}
JSON,
        'coronavirus-tsar-mike-pence-jets-off-to-florida-for-republican-fundraiser-amid-health-crisis' => <<<JSON
{"article":{"title":"Coronavirus tsar Mike Pence jets off to Florida for Republican fundraiser amid health crisis","subtitle":"The event is charging $5,000 for people to take pictures with the vice president ","slug":"coronavirus-tsar-mike-pence-jets-off-to-florida-for-republican-fundraiser-amid-health-crisis","summary":"Coronavirus tsar Mike Pence is jetting off to Florida for a Republican fundraiser on Friday amid the health crisis that\u0027s causing fear among the count","content":"\u003Cp\u003ECoronavirus tsar Mike Pence is jetting off to Florida for a Republican fundraiser on Friday amid the health crisis that\u0027s causing fear among the country. \u003C/p\u003E\u003Cp\u003EThe vice president was announced this week as being the lead person appointed by President Donald Trump to handle the containment of the high-spreading coronavirus in the US, shocking health officials including, reportedly, Trump\u0027s own health secretary. \u003C/p\u003E\u003Cp\u003ETrump\u0027s decision comes as the stock market is having its worst week since 2008 and the first known case of the coronavirus in America not linked to travel in China has surfaced. \u003C/p\u003E\u003Cp\u003EOn Thursday, Pence organised a coronavirus task force meeting to discuss the impending pandemic, which the Centres for Disease Control and Prevention said is not a matter of if but when. \u003C/p\u003E\u003Cp\u003EHe also visited the Secretary\u0027s Operation Centre at Health and Human Services.\u003C/p\u003E\u003Cp\u003EAmid the health crisis, Pence is choosing to still travel to Florida as a \u0022special guest\u0022 for the Republican Party fundraiser, which is set to take place Friday evening. \u003C/p\u003E\u003Cp\u003EPeople attending the fundraiser in Longboat Key, Florida, can pay $2,500 to attend, $5,000 to also receive a selfie with the vice president, and $25,000 to dine with the man, according to an invitation obtained by the Tampa Bay Times. \u003C/p\u003E\u003Cp\u003EThe Florida trip was scheduled before Trump announced on Wednesday he would be putting the coronavirus on Pence\u0027s plate. \u003C/p\u003E\u003Cp\u003EPence\u0027s team potentially anticipated the backlash the vice president would receive for attending the fundraiser amid the health crisis. An item on his agenda titled \u0022Florida coronavirus response meeting\u0022 was added before he left Washington DC. \u003C/p\u003E\u003Cp\u003EKatie Miller, the vice president\u0027s press secretary, also said Pence would be hosting coronavirus task force meetings on Friday and Saturday in Washington, according to CNN. \u003C/p\u003E\u003Cp\u003EThe decision to nominate Pence to lead the coronavirus response in the US faced backlash, with people bringing up the vice president\u0027s previous history when dealing with health crises. \u003C/p\u003E\u003Cp\u003EWhen he was governor of Indiana, the state faced an HIV epidemic in 2014. One study in 2018 from the Lancet Medical Journal said the number of those infected by HIV would\u0027ve been lower had the vice president acted sooner to the public health crisis. \u003C/p\u003E\u003Cp\u003EThere are 60 known cases of the coronavirus currently in the US. None of the cases are based in Florida. \u003C/p\u003E\u003Cp\u003EOnly the best news in your inbox\u003C/p\u003E\u003Cp\u003ERegister with your social account or click here to log in\u003C/p\u003E","author":"Danielle Zoellner","url":"https://www.independent.co.uk/news/world/americas/coronavirus-mike-pence-trump-cdc-stock-market-florida-republican-fundraiser-a9365816.html","source":"The Independent","publishDate":"2020-02-29T20:04:13+00:00","date":"2020-02-29T20:04:13+00:00","status":"2","articleTypeId":"1","sourceId":"12","keywords":[""],"image":"https://static.independent.co.uk/s3fs-public/thumbnails/image/2020/02/24/13/pri141730823.jpg?width=1000\u0026height=614\u0026fit=bounds\u0026format=pjpg\u0026auto=webp\u0026quality=70\u0026crop=16:9,offset-y0.5","images":["https://static.independent.co.uk/s3fs-public/thumbnails/image/2020/02/24/13/pri141730823.jpg?width=1000\u0026height=614\u0026fit=bounds\u0026format=pjpg\u0026auto=webp\u0026quality=70\u0026crop=16:9,offset-y0.5","https://static.independent.co.uk/s3fs-public/thumbnails/image/2020/02/24/13/pri141704167.jpg","https://static.independent.co.uk/s3fs-public/thumbnails/image/2020/02/24/13/pri141200696.jpg","https://static.independent.co.uk/s3fs-public/thumbnails/image/2020/02/24/13/pri141200443.jpg","https://polarcdn-terrax.com/image/v1.0.0/bin/5e4abf48fc70759534abd789?v=e556a\u0026w=100\u0026h=66","https://polarcdn-terrax.com/image/v1.0.0/bin/5dcedeb85159acc4ec92ddf3?v=848d5\u0026w=100\u0026h=66","https://polarcdn-terrax.com/image/v1.0.0/bin/5e05df9cfc70759534aa7406?v=7ff39\u0026w=100\u0026h=66","https://polarcdn-terrax.com/image/v1.0.0/bin/5e1c92fc5159acc4ec944459?v=e9db5\u0026w=100\u0026h=66","https://polarcdn-terrax.com/image/v1.0.0/bin/5dcede5a5159acc4ec92dde9?v=f08a7\u0026w=100\u0026h=66"],"featured":"1","categories":["currentAffairs","currentAffairs-world"],"displayCategories":[{"code":"currentAffairs-world","name":"World"}],"id":"1429590"}}
JSON,
        'france-warns-against-handshakes-as-corona-infections-soar' => <<<JSON
{"article":{"title":"France warns against handshakes as corona infections soar","subtitle":"","slug":"france-warns-against-handshakes-as-corona-infections-soar","summary":"PARIS (Reuters) - French authorities on Friday recommended that people refrain from shaking hands to prevent infection from the coronavirus as the num","content":"\u003Cp\u003EPARIS (Reuters) - French authorities on Friday recommended that people refrain from shaking hands to prevent infection from the coronavirus as the number of confirmed cases jumped by 19 to 57.\u003C/p\u003E\u003Cp\u003EFrance will also keep several schools in the Oise area north of Paris closed after holidays end on Sunday in order to halt the spread of the virus, Health Minister Olivier Veran said.\u003C/p\u003E\u003Cp\u003E\u201cThe virus is now circulating on our territory ... I recommend that, for now, people do not shake hands,\u201d Veran told reporters at a daily briefing about the outbreak.\u003C/p\u003E\u003Cp\u003EVeran called on citizens to help stop the spread of the virus by respecting authorities\u2019 safety instructions.\u003C/p\u003E\u003Cp\u003E\u201cProtect yourself and your loved ones,\u201d he said.\u003C/p\u003E\u003Cp\u003ESeparately, Defence Minister Florence Parly said on her Twitter feed that several confirmed coronavirus infections had been reported on the military base of Creil, north of Paris.\u003C/p\u003E\u003Cp\u003EFrench President Emmanuel Macron\u2019s office said on Friday that the government will meet on Saturday to discuss the health crisis.\u003C/p\u003E\u003Cp\u003EOn Thursday, the health ministry had reported 38 cases of coronavirus in France, of which two people had died, 12 were cured and 24 were hospitalized, with two of those being in a \u201cserious condition\u201d.\u003C/p\u003E\u003Cp\u003EReporting by Geert De Clercq, Matthieu Protard and John Irish; Writing by Geert De Clercq; Editing by Franklin Paul and Chizu Nomiyama\u003C/p\u003E","author":"Unknown","url":"https://uk.reuters.com/article/uk-china-health-france/france-reports-19-new-coronavirus-cases-warns-against-handshakes-idUKKCN20M2ZQ?il=0","source":"Reuters","publishDate":"2020-02-29T20:04:13+00:00","date":"2020-02-29T20:04:13+00:00","status":"2","articleTypeId":"1","sourceId":"9","keywords":[""],"image":"https://s1.reutersmedia.net/resources/r/?m=02\u0026d=20200228\u0026t=2\u0026i=1496644050\u0026r=LYNXNPEG1R1X2\u0026w=960","images":["https://s1.reutersmedia.net/resources/r/?m=02\u0026d=20200228\u0026t=2\u0026i=1496644050\u0026r=LYNXNPEG1R1X2\u0026w=960","https://s1.reutersmedia.net/resources/r/?m=02\u0026d=20200228\u0026t=2\u0026i=1496644050\u0026r=LYNXNPEG1R1X2\u0026w=20"],"featured":"1","categories":["currentAffairs","currentAffairs-world"],"displayCategories":[{"code":"currentAffairs-world","name":"World"}],"id":"1429596"}}
JSON,

    ];

    /**
     * @Given the microservice view page URL is loaded with slug :slug
     * @param string $slug
     */
    public function theMicroserviceViewPageUrlIsLoadedWithSlug(string $slug): void
    {
        $client = new Client();
        $this->response = $client->get('hal-article-web/' . $slug, ['http_errors' => false]);
    }

    /**
     * @When a :statusCode article response is be recieved
     * @param int $statusCode
     */
    public function aArticleResponseIsBeRecieved(int $statusCode): void
    {
        Assert::assertEquals($statusCode, $this->response->getStatusCode());
    }

    /**
     * @Then the :slug article content will be returned in a JSON format
     * @param string $slug
     */
    public function theArticleContentWillBeReturnedInAJsonFormat(string $slug): void
    {
        $expected = $this->articleResponses[$slug];
        $actual = $this->response->getBody()->getContents();
        Assert::assertEquals($expected, $actual);
    }

    /**
     * @Then an empty article response will be returned
     */
    public function anEmptyArticleResponseWillBeReturned(): void
    {
        Assert::assertEmpty($this->response->getBody()->getContents());
    }
}
